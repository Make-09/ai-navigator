<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>AI Navigator</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; overflow: hidden; }
    #root { width: 100%; height: 100vh; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const LOCALES = {
      ru: { code: "ru", name: "Ğ ÑƒÑÑĞºĞ¸Ğ¹", flag: "ğŸ‡·ğŸ‡º", strings: { title: "AI Navigator", subtitle: "AI-Ğ½Ğ°ÑÑ‚Ğ°Ğ²Ğ½Ğ¸Ğº", placeholder: "Ğ’Ğ°Ñˆ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ...", loading: "AI Ğ´ÑƒĞ¼Ğ°ĞµÑ‚...", error: "ĞÑˆĞ¸Ğ±ĞºĞ°", newChat: "ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚", deleteChat: "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ", noChats: "ĞĞµÑ‚ Ñ‡Ğ°Ñ‚Ğ¾Ğ²", about: "Ğ Ğ½Ğ°Ñ", policy: "ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°", copyright: "Ğ¨ĞºĞ¾Ğ»ÑŒĞ½Ğ¸ĞºĞ¸ Ğ¸Ğ· Ğ¨Ñ‹Ğ¼ĞºĞµĞ½Ñ‚Ğ° Ğ¸ Ğ£Ñ€Ğ°Ğ»ÑŒÑĞºĞ°", chatHistory: "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ", aboutTitle: "Ğ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ", aboutText: "AI Navigator Ğ´Ğ»Ñ ÑˆĞºĞ¾Ğ»ÑŒĞ½Ğ¸ĞºĞ¾Ğ² ĞšĞ°Ğ·Ğ°Ñ…ÑÑ‚Ğ°Ğ½Ğ°", policyTitle: "ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°", policyText: "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ" }},
      en: { code: "en", name: "English", flag: "ğŸ‡¬ğŸ‡§", strings: { title: "AI Navigator", subtitle: "AI mentor", placeholder: "Your question...", loading: "AI thinking...", error: "Error", newChat: "New Chat", deleteChat: "Delete", noChats: "No chats", about: "About", policy: "Policy", copyright: "Students from Shymkent and Uralsk", chatHistory: "History", aboutTitle: "About", aboutText: "AI Navigator for Kazakhstan students", policyTitle: "Policy", policyText: "History stored locally" }},
      kk: { code: "kk", name: "ÒšĞ°Ğ·Ğ°Ò›ÑˆĞ°", flag: "ğŸ‡°ğŸ‡¿", strings: { title: "AI Navigator", subtitle: "AI-ĞºĞµÒ£ĞµÑÑˆÑ–", placeholder: "Ğ¡Ò±Ñ€Ğ°Ò“Ñ‹Ò£Ñ‹Ğ·...", loading: "AI Ğ¾Ğ¹Ğ»Ğ°Ğ½ÑƒĞ´Ğ°...", error: "ÒšĞ°Ñ‚Ğµ", newChat: "Ğ–Ğ°Ò£Ğ° Ñ‡Ğ°Ñ‚", deleteChat: "Ğ–Ğ¾Ñ", noChats: "Ğ§Ğ°Ñ‚Ñ‚Ğ°Ñ€ Ğ¶Ğ¾Ò›", about: "Ğ‘Ñ–Ğ· Ñ‚ÑƒÑ€Ğ°Ğ»Ñ‹", policy: "Ğ¡Ğ°ÑÑĞ°Ñ‚", copyright: "Ğ¨Ñ‹Ğ¼ĞºĞµĞ½Ñ‚ Ğ¶Ó™Ğ½Ğµ ĞÑ€Ğ°Ğ» Ğ¾Ò›ÑƒÑˆÑ‹Ğ»Ğ°Ñ€Ñ‹", chatHistory: "Ğ¢Ğ°Ñ€Ğ¸Ñ…", aboutTitle: "Ğ‘Ñ–Ğ· Ñ‚ÑƒÑ€Ğ°Ğ»Ñ‹", aboutText: "ÒšĞ°Ğ·Ğ°Ò›ÑÑ‚Ğ°Ğ½ Ğ¾Ò›ÑƒÑˆÑ‹Ğ»Ğ°Ñ€Ñ‹Ğ½Ğ°", policyTitle: "Ğ¡Ğ°ÑÑĞ°Ñ‚", policyText: "Ğ¢Ğ°Ñ€Ğ¸Ñ… Ğ¶ĞµÑ€Ğ³Ñ–Ğ»Ñ–ĞºÑ‚Ñ– ÑĞ°Ò›Ñ‚Ğ°Ğ»Ğ°Ğ´Ñ‹" }},
      ja: { code: "ja", name: "æ—¥æœ¬èª", flag: "ğŸ‡¯ğŸ‡µ", strings: { title: "AI Navigator", subtitle: "AIãƒ¡ãƒ³ã‚¿ãƒ¼", placeholder: "è³ªå•...", loading: "AIæ€è€ƒä¸­...", error: "ã‚¨ãƒ©ãƒ¼", newChat: "æ–°è¦", deleteChat: "å‰Šé™¤", noChats: "ãƒãƒ£ãƒƒãƒˆãªã—", about: "ã«ã¤ã„ã¦", policy: "ãƒãƒªã‚·ãƒ¼", copyright: "å­¦ç”Ÿãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ", chatHistory: "å±¥æ­´", aboutTitle: "ã«ã¤ã„ã¦", aboutText: "ã‚«ã‚¶ãƒ•ã‚¹ã‚¿ãƒ³ã®å­¦ç”Ÿå‘ã‘", policyTitle: "ãƒãƒªã‚·ãƒ¼", policyText: "ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜" }},
      zh: { code: "zh", name: "ä¸­æ–‡", flag: "ğŸ‡¨ğŸ‡³", strings: { title: "AI Navigator", subtitle: "AIå¯¼å¸ˆ", placeholder: "æ‚¨çš„é—®é¢˜...", loading: "AIæ€è€ƒä¸­...", error: "é”™è¯¯", newChat: "æ–°å¯¹è¯", deleteChat: "åˆ é™¤", noChats: "æ— å¯¹è¯", about: "å…³äº", policy: "æ”¿ç­–", copyright: "å­¦ç”Ÿé¡¹ç›®", chatHistory: "å†å²", aboutTitle: "å…³äº", aboutText: "ä¸ºå“ˆè¨å…‹æ–¯å¦å­¦ç”Ÿ", policyTitle: "æ”¿ç­–", policyText: "æœ¬åœ°å­˜å‚¨" }},
      ko: { code: "ko", name: "í•œêµ­ì–´", flag: "ğŸ‡°ğŸ‡·", strings: { title: "AI Navigator", subtitle: "AIë©˜í† ", placeholder: "ì§ˆë¬¸...", loading: "AIìƒê°ì¤‘...", error: "ì˜¤ë¥˜", newChat: "ìƒˆ ì±„íŒ…", deleteChat: "ì‚­ì œ", noChats: "ì±„íŒ… ì—†ìŒ", about: "ì†Œê°œ", policy: "ì •ì±…", copyright: "í•™ìƒ í”„ë¡œì íŠ¸", chatHistory: "ê¸°ë¡", aboutTitle: "ì†Œê°œ", aboutText: "ì¹´ìíìŠ¤íƒ„ í•™ìƒìš©", policyTitle: "ì •ì±…", policyText: "ë¡œì»¬ ì €ì¥" }}
    };

    function Modal({ isOpen, onClose, title, content, isDark }) {
      if (!isOpen) return null;
      const surface = isDark ? '#1e293b' : '#fff';
      const text = isDark ? '#e2e8f0' : '#0f172a';
      return (<div className="modal-overlay" onClick={onClose}><div onClick={(e) => e.stopPropagation()} style={{ background: surface, borderRadius: 16, padding: '2rem', maxWidth: 600, width: '90%', maxHeight: '80vh', overflow: 'auto' }}><div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '1.5rem' }}><h2 style={{ fontSize: '1.5rem', color: text }}>{title}</h2><button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer', color: text }}>âœ•</button></div><div style={{ whiteSpace: 'pre-wrap', lineHeight: 1.7, color: text }}>{content}</div></div></div>);
    }

    function App() {
      const [locale, setLocale] = useState('ru');
      const [theme, setTheme] = useState('light');
      const [chats, setChats] = useState([]);
      const [currentChatId, setCurrentChatId] = useState(null);
      const [input, setInput] = useState('');
      const [loading, setLoading] = useState(false);
      const [sidebarOpen, setSidebarOpen] = useState(true);
      const [showAbout, setShowAbout] = useState(false);
      const [showPolicy, setShowPolicy] = useState(false);
      const chatRef = useRef(null);
      const t = LOCALES[locale].strings;

      useEffect(() => {
        setTheme(localStorage.getItem('theme') || 'light');
        setLocale(localStorage.getItem('locale') || 'ru');
        const saved = localStorage.getItem('chats');
        if (saved) {
          const parsedChats = JSON.parse(saved);
          setChats(parsedChats);
          if (parsedChats.length > 0) setCurrentChatId(parsedChats[0].id);
        }
      }, []);

      useEffect(() => {
        if (chatRef.current) chatRef.current.scrollTop = chatRef.current.scrollHeight;
      }, [chats, currentChatId]);

      const saveChats = (updatedChats) => { localStorage.setItem('chats', JSON.stringify(updatedChats)); setChats(updatedChats); };
      const createNewChat = () => { const newChat = { id: Date.now(), title: `${t.newChat} ${chats.length + 1}`, messages: [], createdAt: new Date().toISOString() }; saveChats([newChat, ...chats]); setCurrentChatId(newChat.id); };
      const deleteChat = (chatId) => { const updatedChats = chats.filter(c => c.id !== chatId); saveChats(updatedChats); if (currentChatId === chatId) setCurrentChatId(updatedChats.length > 0 ? updatedChats[0].id : null); };
      const updateCurrentChat = (updater) => { saveChats(chats.map(chat => chat.id === currentChatId ? updater(chat) : chat)); };

      const sendMessage = async () => {
        if (!input.trim() || loading) return;
        if (!currentChatId) { createNewChat(); setTimeout(() => sendMessage(), 100); return; }
        const userMsg = input.trim();
        setInput('');
        updateCurrentChat(chat => ({ ...chat, messages: [...chat.messages, { role: 'user', content: userMsg, id: Date.now() }] }));
        setLoading(true);
        try {
          const res = await fetch(window.location.origin + '/api/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, credentials: 'include', body: JSON.stringify({ message: userMsg, chatId: currentChatId }) });
          const data = await res.json();
          updateCurrentChat(chat => ({ ...chat, messages: [...chat.messages, { role: 'assistant', content: data.reply || data.error, id: Date.now() + 1 }] }));
        } catch (error) {
          updateCurrentChat(chat => ({ ...chat, messages: [...chat.messages, { role: 'assistant', content: t.error, id: Date.now() + 1 }] }));
        } finally { setLoading(false); }
      };

      const toggleTheme = () => { const newTheme = theme === 'dark' ? 'light' : 'dark'; setTheme(newTheme); localStorage.setItem('theme', newTheme); };
      const changeLocale = (newLocale) => { setLocale(newLocale); localStorage.setItem('locale', newLocale); };

      const isDark = theme === 'dark';
      const bg = isDark ? '#0f172a' : '#f8fafc';
      const surface = isDark ? '#1e293b' : '#fff';
      const text = isDark ? '#e2e8f0' : '#0f172a';
      const textSecondary = isDark ? '#94a3b8' : '#64748b';
      const border = isDark ? '#334155' : '#e2e8f0';
      const currentChat = chats.find(c => c.id === currentChatId);

      return (<div style={{ background: bg, height: '100vh', color: text, display: 'flex', flexDirection: 'column' }}>
        <Modal isOpen={showAbout} onClose={() => setShowAbout(false)} title={t.aboutTitle} content={t.aboutText} isDark={isDark} />
        <Modal isOpen={showPolicy} onClose={() => setShowPolicy(false)} title={t.policyTitle} content={t.policyText} isDark={isDark} />
        <header style={{ padding: '1rem 1.5rem', borderBottom: `1px solid ${border}`, display: 'flex', justifyContent: 'space-between', background: surface }}>
          <div style={{ display: 'flex', gap: '1rem' }}>
            <button onClick={() => setSidebarOpen(!sidebarOpen)} style={{ background: 'none', border: 'none', color: text, cursor: 'pointer', fontSize: '1.5rem' }}>â˜°</button>
            <div style={{ display: 'flex', gap: '0.75rem' }}>
              <div style={{ width: 40, height: 40, background: 'linear-gradient(135deg, #3b82f6, #8b5cf6)', borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 'bold' }}>AI</div>
              <div><div style={{ fontWeight: 600 }}>{t.title}</div><div style={{ fontSize: '0.75rem', color: textSecondary }}>{t.subtitle}</div></div>
            </div>
          </div>
          <div style={{ display: 'flex', gap: '0.5rem' }}>
            <select value={locale} onChange={(e) => changeLocale(e.target.value)} style={{ padding: '0.5rem', borderRadius: 8, border: `1px solid ${border}`, background: surface, color: text, cursor: 'pointer' }}>{Object.values(LOCALES).map(loc => <option key={loc.code} value={loc.code}>{loc.flag} {loc.name}</option>)}</select>
            <button onClick={toggleTheme} style={{ padding: '0.5rem 1rem', borderRadius: 8, border: `1px solid ${border}`, background: surface, cursor: 'pointer' }}>{isDark ? 'â˜€ï¸' : 'ğŸŒ™'}</button>
          </div>
        </header>
        <div style={{ display: 'flex', flex: 1, overflow: 'hidden' }}>
          {sidebarOpen && <aside style={{ width: 280, background: surface, borderRight: `1px solid ${border}`, display: 'flex', flexDirection: 'column', padding: '1rem' }}>
            <button onClick={createNewChat} style={{ padding: '0.75rem', borderRadius: 8, background: '#3b82f6', color: 'white', border: 'none', cursor: 'pointer', fontWeight: 600, marginBottom: '1rem' }}>+ {t.newChat}</button>
            <div style={{ fontSize: '0.75rem', fontWeight: 600, color: textSecondary, marginBottom: '0.5rem', textTransform: 'uppercase' }}>{t.chatHistory}</div>
            <div style={{ flex: 1, overflowY: 'auto' }}>{chats.length === 0 ? <div style={{ textAlign: 'center', padding: '2rem 1rem', color: textSecondary }}>{t.noChats}</div> : chats.map(chat => <div key={chat.id} style={{ display: 'flex', gap: '0.5rem', padding: '0.75rem', marginBottom: '0.5rem', borderRadius: 8, background: currentChatId === chat.id ? (isDark ? '#334155' : '#f1f5f9') : 'transparent', cursor: 'pointer' }} onClick={() => setCurrentChatId(chat.id)}><div style={{ flex: 1, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{chat.messages.length > 0 ? chat.messages[0].content.substring(0, 30) + '...' : chat.title}</div><button onClick={(e) => { e.stopPropagation(); deleteChat(chat.id); }} style={{ background: 'none', border: 'none', color: '#ef4444', cursor: 'pointer' }}>ğŸ—‘ï¸</button></div>)}</div>
          </aside>}
          <main style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
            <div ref={chatRef} style={{ flex: 1, overflowY: 'auto', padding: '2rem', maxWidth: 900, margin: '0 auto', width: '100%' }}>
              {(!currentChat || currentChat.messages.length === 0) && <div style={{ textAlign: 'center', padding: '4rem 2rem', color: textSecondary }}><div style={{ fontSize: '4rem', marginBottom: '1rem' }}>ğŸ§­</div><h2 style={{ color: text }}>{t.title}</h2><p>{t.subtitle}</p></div>}
              {currentChat?.messages.map(msg => <div key={msg.id} style={{ marginBottom: '1.5rem', display: 'flex', justifyContent: msg.role === 'user' ? 'flex-end' : 'flex-start' }}><div style={{ maxWidth: '75%', padding: '1rem 1.25rem', borderRadius: 16, background: msg.role === 'user' ? 'linear-gradient(135deg, #3b82f6, #8b5cf6)' : (isDark ? '#1e293b' : '#f1f5f9'), color: msg.role === 'user' ? 'white' : text, whiteSpace: 'pre-wrap' }}>{msg.content}</div></div>)}
              {loading && <div style={{ padding: '1rem', color: textSecondary, fontStyle: 'italic' }}>{t.loading}</div>}
            </div>
            <div style={{ padding: '1.5rem', borderTop: `1px solid ${border}`, background: surface }}>
              <div style={{ maxWidth: 900, margin: '0 auto', display: 'flex', gap: '0.75rem' }}>
                <textarea value={input} onChange={(e) => setInput(e.target.value)} onKeyPress={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } }} placeholder={t.placeholder} style={{ flex: 1, padding: '1rem', borderRadius: 12, border: `1px solid ${border}`, background: isDark ? '#1e293b' : '#fff', color: text, resize: 'none' }} rows={2} />
                <button onClick={sendMessage} disabled={loading || !input.trim()} style={{ padding: '1rem 2rem', borderRadius: 12, background: loading || !input.trim() ? '#999' : 'linear-gradient(135deg, #3b82f6, #8b5cf6)', color: 'white', border: 'none', cursor: loading || !input.trim() ? 'not-allowed' : 'pointer', fontWeight: 600, fontSize: '1.5rem' }}>â¤</button>
              </div>
            </div>
          </main>
        </div>
        <footer style={{ padding: '1rem', textAlign: 'center', borderTop: `1px solid ${border}`, background: surface, fontSize: '0.85rem', color: textSecondary }}>
          <div style={{ marginBottom: '0.5rem' }}>
            <button onClick={() => setShowAbout(true)} style={{ background: 'none', border: 'none', color: '#3b82f6', cursor: 'pointer', marginRight: '1.5rem' }}>{t.about}</button>
            <button onClick={() => setShowPolicy(true)} style={{ background: 'none', border: 'none', color: '#3b82f6', cursor: 'pointer' }}>{t.policy}</button>
          </div>
          <div>Â© 2024 AI Navigator â€” {t.copyright}</div>
        </footer>
      </div>);
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>